{{ define "main" }}
<div class="posts-list-page">
    <!-- Page Header -->
    {{ $allPosts := where site.RegularPages "Type" "posts" }}
    
    <!-- Custom heading with muted count -->
    <div style="margin: 0.5rem 0;">
        {{ partial "line.html" . }}
        <h2 style="padding: 1rem; font-size: 0.75rem; text-transform: uppercase; font-family: var(--font-mono); margin: 0;">
            <span style="color: var(--color-muted); margin-right: 0.5rem;" aria-hidden="true">01 /</span>
            {{ .Title }}
            {{ if $allPosts }}
            <span style="color: var(--color-muted); margin-left: 0.5rem;">({{ len $allPosts }} Posts)</span>
            {{ end }}
        </h2>
        {{ partial "line.html" . }}
    </div>
    
    <section class="p-4">
        {{ if .Content }}
        <div class="page-description">
            {{ .Content }}
        </div>
        {{ end }}
    </section>

    {{ if $allPosts }}
    <!-- 使用所有文章，按日期排序 -->
    {{ $sortedPosts := $allPosts }}
    
    {{ $recentPosts := first 3 $sortedPosts }}
    {{ $remainingPosts := after 3 $sortedPosts }}

    <!-- 最新3篇文章 - 大卡片布局 -->
    {{ if $recentPosts }}
    {{ partial "heading.html" (dict "index" "02" "text" "Recent Posts") }}
    <section class="p-4">
        <div class="featured-posts">
                <div class="featured-posts-container">
                    {{ range $recentPosts }}
                    <article class="large-post-card">
                        <div class="featured-card-content">
                            <!-- 左侧内容 -->
                            <div class="featured-card-left">
                                <!-- 日期区域 -->
                                <div class="featured-card-date">
                                    <time datetime="{{ .Date.Format " 2006-01-02" }}" class="post-date">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="date-icon">
                                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                            <line x1="16" y1="2" x2="16" y2="6"></line>
                                            <line x1="8" y1="2" x2="8" y2="6"></line>
                                            <line x1="3" y1="10" x2="21" y2="10"></line>
                                        </svg>
                                        {{ partial "smart-date.html" . }}
                                    </time>
                                    {{ partial "category-badge.html" . }}
                                </div>

                                <div class="featured-card-text">
                                    <h3 class="featured-card-title">
                                        <a href="{{ .RelPermalink }}" class="featured-card-link">
                                            <span class="title-content">{{ partial "status-badge.html" . }}{{ .Title }}</span>
                                        </a>
                                    </h3>

                                    {{ if .Params.description }}
                                    <p class="featured-card-description">
                                        {{ .Params.description }}
                                    </p>
                                    {{ else if .Summary }}
                                    <p class="featured-card-description">
                                        {{ .Summary }}
                                    </p>
                                    {{ end }}
                                </div>

                                <!-- 元数据 -->
                                <div class="featured-card-meta">
                                    <div class="meta-row">
                                        <!-- 其他元数据可以在这里添加 -->
                                    </div>
                                </div>
                            </div>

                            <!-- 右侧特色图 -->
                            <div class="featured-right-section">
                                {{ if .Params.image }}
                                <div class="featured-image">
                                    <img src="{{ .Params.image }}" alt="{{ .Title }}" class="featured-img">
                                </div>
                                {{ else }}
                                <div class="featured-image-placeholder">
                                    <span class="placeholder-text">暂无图片</span>
                                </div>
                                {{ end }}
                            </div>
                        </div>
                    </article>
                    {{ end }}
            </div>
        </div>
    </section>
    {{ end }}

    <!-- 其余文章 - 小卡片2列布局 -->
    {{ if $remainingPosts }}
    {{ partial "heading.html" (dict "index" "03" "text" "More Posts") }}
    <section class="p-4">
        <div class="archive-posts">
            <div id="posts-container" class="posts-grid">
                <!-- 初始显示的文章 -->
                {{ range first 10 $remainingPosts }}
                <article class="card small-card post-item">
                    <div class="small-card-content">
                        <h3 class="small-card-title">
                            <a href="{{ .RelPermalink }}" class="small-card-link">
                                <span class="title-content">{{ partial "status-badge.html" . }}{{ .Title }}</span>
                            </a>
                        </h3>

                        <div class="small-card-footer">
                            <div class="small-card-meta">
                                <time datetime="{{ .Date.Format " 2006-01-02" }}" class="post-date">
                                    {{ partial "smart-date.html" . }}
                                </time>
                                {{ partial "category-badge.html" . }}
                            </div>

                            <a href="{{ .RelPermalink }}" class="read-link">
                                阅读 →
                            </a>
                        </div>
                    </div>
                </article>
                {{ end }}
            </div>

            <!-- 隐藏的文章用于无限滚动 -->
            {{ if gt (len $remainingPosts) 10 }}
            <div id="hidden-posts" class="hidden-posts">
                {{ range after 10 $remainingPosts }}
                <article class="card small-card post-item">
                    <div class="small-card-content">
                        <h3 class="small-card-title">
                            <a href="{{ .RelPermalink }}" class="small-card-link">
                                <span class="title-content">{{ partial "status-badge.html" . }}{{ .Title }}</span>
                            </a>
                        </h3>

                        <div class="small-card-footer">
                            <div class="small-card-meta">
                                <time datetime="{{ .Date.Format " 2006-01-02" }}" class="post-date">
                                    {{ partial "smart-date.html" . }}
                                </time>
                                {{ partial "category-badge.html" . }}
                            </div>

                            <a href="{{ .RelPermalink }}" class="read-link">
                                阅读 →
                            </a>
                        </div>
                    </div>
                </article>
                {{ end }}
            </div>

            <!-- 加载指示器 -->
            <div id="loading-indicator" class="loading-indicator">
                <div class="loading-content">
                    <div class="loading-spinner"></div>
                    正在加载更多文章...
                </div>
            </div>

        <div id="load-more-trigger" class="load-more-trigger"></div>
        {{ end }}
        </div>
    </section>
    {{ end }}

    {{ else }}
    <section class="p-4">
        <div class="card text-center">
            <p class="no-posts-message">
                暂无文章。
            </p>
        </div>
    </section>
    {{ end }}
</div>

{{ $postsListJS := resources.Get "js/posts-list.js" | minify }}
<script src="{{ $postsListJS.RelPermalink }}" defer></script>
{{ end }}